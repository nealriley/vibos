<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>VibeOS Taskbar</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    html, body {
      width: 100%;
      height: 64px;
      background: #1a1a2e;
      overflow: hidden;
      -webkit-app-region: no-drag;
    }
    
    .taskbar {
      height: 64px;
      display: flex;
      align-items: center;
      padding: 0 8px;
      gap: 8px;
    }
    
    .icon {
      width: 48px;
      height: 48px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: transform 0.15s ease, box-shadow 0.15s ease;
      user-select: none;
      position: relative;
      flex-shrink: 0;
    }
    
    .icon:hover {
      transform: scale(1.1);
    }
    
    .icon:active {
      transform: scale(0.95);
    }
    
    /* V logo icon */
    .icon.vibeos {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }
    
    .icon.vibeos:hover {
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4);
    }
    
    .logo-text {
      color: white;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-weight: 700;
      font-size: 22px;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
    }
    
    /* App icons */
    .icon.app {
      background: #2d2d44;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
      font-size: 20px;
    }
    
    .icon.app:hover {
      background: #3d3d54;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }
    
    .app-letter {
      color: white;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-weight: 600;
      font-size: 18px;
      text-transform: uppercase;
    }
    
    /* Close button on hover */
    .icon.app .close-btn {
      position: absolute;
      top: -4px;
      right: -4px;
      width: 16px;
      height: 16px;
      background: #ef4444;
      border-radius: 50%;
      display: none;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      color: white;
      font-weight: bold;
      line-height: 1;
    }
    
    .icon.app:hover .close-btn {
      display: flex;
    }
    
    .close-btn:hover {
      background: #dc2626;
      transform: scale(1.2);
    }
    
    /* Tooltip */
    .icon .tooltip {
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background: #0a0a0a;
      color: #e0e0e0;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 11px;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      white-space: nowrap;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s ease;
      margin-bottom: 8px;
      max-width: 200px;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .icon:hover .tooltip {
      opacity: 1;
    }
    
    /* App-specific colors */
    .icon.app.chrome { background: linear-gradient(135deg, #4285f4 0%, #34a853 50%, #fbbc05 75%, #ea4335 100%); }
    .icon.app.firefox { background: linear-gradient(135deg, #ff9500 0%, #ff0039 100%); }
    .icon.app.terminal { background: #1e1e1e; border: 1px solid #333; }
    .icon.app.code { background: #007acc; }
  </style>
</head>
<body>
  <div class="taskbar" id="taskbar">
    <!-- V icon always first -->
    <div class="icon vibeos" id="vibeos-icon">
      <span class="logo-text">V</span>
      <span class="tooltip">VibeOS</span>
    </div>
    <!-- App icons will be added here dynamically -->
  </div>
  
  <script>
    const taskbar = document.getElementById('taskbar');
    const vibeosIcon = document.getElementById('vibeos-icon');
    
    // Handle V icon click - toggle main window
    vibeosIcon.addEventListener('click', () => {
      if (window.vibeos && window.vibeos.toggleMainWindow) {
        window.vibeos.toggleMainWindow();
      }
    });
    
    // Get app color class based on window class/title
    function getAppColorClass(windowClass, title) {
      const lowerClass = (windowClass || '').toLowerCase();
      const lowerTitle = (title || '').toLowerCase();
      
      if (lowerClass.includes('chrome') || lowerClass.includes('chromium') || lowerTitle.includes('chrome')) {
        return 'chrome';
      }
      if (lowerClass.includes('firefox') || lowerTitle.includes('firefox')) {
        return 'firefox';
      }
      if (lowerClass.includes('terminal') || lowerClass.includes('xfce4-terminal') || lowerClass.includes('xterm')) {
        return 'terminal';
      }
      if (lowerClass.includes('code') || lowerTitle.includes('visual studio')) {
        return 'code';
      }
      return '';
    }
    
    // Get first letter for icon
    function getAppLetter(windowClass, title) {
      // Prefer title if meaningful
      if (title && title.length > 0 && title !== 'unknown') {
        return title.charAt(0).toUpperCase();
      }
      if (windowClass && windowClass !== 'unknown') {
        return windowClass.charAt(0).toUpperCase();
      }
      return '?';
    }
    
    // Truncate title for tooltip
    function truncateTitle(title, maxLength = 40) {
      if (!title) return 'Unknown';
      if (title.length <= maxLength) return title;
      return title.substring(0, maxLength) + '...';
    }
    
    // Update taskbar with running windows
    function updateTaskbar(windows) {
      // Remove existing app icons (keep V icon)
      const existingApps = taskbar.querySelectorAll('.icon.app');
      existingApps.forEach(el => el.remove());
      
      // Add icons for each window
      windows.forEach(win => {
        const icon = document.createElement('div');
        const colorClass = getAppColorClass(win.class, win.title);
        icon.className = `icon app ${colorClass}`;
        icon.setAttribute('data-window-id', win.id);
        
        const letter = getAppLetter(win.class, win.title);
        
        icon.innerHTML = `
          <span class="app-letter">${letter}</span>
          <span class="tooltip">${truncateTitle(win.title)}</span>
          <span class="close-btn" data-action="close">Ã—</span>
        `;
        
        // Click to focus window
        icon.addEventListener('click', (e) => {
          // Don't focus if clicking close button
          if (e.target.dataset.action === 'close') {
            e.stopPropagation();
            if (window.vibeos && window.vibeos.closeWindow) {
              window.vibeos.closeWindow(win.id);
            }
            return;
          }
          
          if (window.vibeos && window.vibeos.focusWindow) {
            window.vibeos.focusWindow(win.id);
          }
        });
        
        taskbar.appendChild(icon);
      });
    }
    
    // Subscribe to window updates
    if (window.vibeos && window.vibeos.onWindowsUpdate) {
      window.vibeos.onWindowsUpdate(updateTaskbar);
    }
  </script>
</body>
</html>
